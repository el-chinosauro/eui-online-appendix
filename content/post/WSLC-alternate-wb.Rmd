---
title: "Within-sector Labour Force Composition"
author:
  - Lorenzo Sileci^[All code and this website are developed and maintained by Lorenzo Sileci (LSE, Department of Geography and Environment; Grantham Research Institute for Climate Change and the Environment; l.sileci@lse.ac.uk)]


date: "18/02/2021"
output: 
  html_document
summary: "Bar plots showing within-sector labour force composition across the last two available waves in the IPUMS dataset."
showDate: false
gallery:
    - http://i.imgur.com/OJdrqWr.png 
    
autoThumbnailImage: yes
thumbnailImagePosition: left
---

***
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

### Within-sector Labour Force Composition 

#### Second to last wave 

<details><summary> Entire Dataset </summary>

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                       rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```
</details>
</details>

<details><summary> Benin </summary>

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) %>%
  group_by(label) %>%
  mutate(subtot = sum(value)) %>%
  mutate(value.resc = value/subtot)

ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>% 
mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```
</details>
</details><details><summary> Botswana </summary>

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details>
</details><details><summary> Egypt </summary>


<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```
</details>

</details><details><summary> Ghana </summary>

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```
</details>
</details><details><summary> Malawi </summary>


<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details>
</details><details><summary> Mali </summary>


<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details>
</details><details><summary> Mauritius </summary>

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details>
</details><details><summary> Morocco </summary>

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```
</details>
</details><details><summary> Mozambique </summary>

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details>
</details><details><summary> Rwanda </summary>

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details>
</details><details><summary> South Africa </summary>

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```
</details>
</details><details><summary> Tanzania </summary>

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```
</details>
</details><details><summary> Zambia </summary>

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "secondtolast")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```
</details>
</details>

#### Last Wave 


<details><summary>Entire Dataset </summary>


<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details>

</details><details><summary> Benin </summary> 

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Benin") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```
</details>

</details><details><summary> Botswana </summary> 

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Botswana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details>

</details><details><summary> Egypt </summary> 

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Egypt") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details>
</details><details><summary> Ghana </summary> 

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Ghana") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```
</details>
</details><details><summary> Malawi </summary> 

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Malawi") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details>
</details><details><summary> Mali </summary> 

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mali") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```
</details>

</details><details><summary> Mauritius </summary> 

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mauritius") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details>
</details><details><summary> Morocco </summary> 

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Morocco") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```
</details>
</details><details><summary> Mozambique</summary> 

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Mozambique") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```
</details>

</details><details><summary> Rwanda</summary> 

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Rwanda") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details>
</details><details><summary> South Africa</summary> 

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "South Africa") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```
</details>
</details><details><summary> Tanzania </summary> 

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Tanzania") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```
</details>
</details><details><summary> Zambia </summary> 

<details><summary> Agriculture </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_agriculture$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Mining </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_mining$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```


</details><details><summary> Manufacturing </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_manufacturing$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Utilities </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_utilities$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Construction </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_construction$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Trade </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_trade$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Accommodation </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_accommodation$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Transport </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_transport$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Finance </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_finance$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Public </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_public$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Unspecified Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_unspec_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Business </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_business$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Education </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_education$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Health </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_health$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Other Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_services$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary>Private Household Services </summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_private_hh$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  )

```

</details><details><summary> Other Industry, n.e.c.</summary>

```{r, echo=F, message=F, warning = F, fig.align='center'}

library(tidyverse)
library(sf)

options(scipen=999)

load("~/Dropbox/Work/RA/services micro ssa/Lorenzo_RA_Work/cleaned-alesina/fullpanel.RData")

total = full_panel_updated %>%
  sf::st_drop_geometry() %>%
  filter(wave == "last")

# Select relevant variables
var_list = c(colnames(total)[grepl("_other_industry$", colnames(total))]) 
var_list = var_list[c(2:25)]

collapsed_data <- total %>%
  filter(country == "Zambia") %>%
  summarise_at(var_list, list(~ mean(., na.rm = T))) %>%
  ungroup()

# Reshape data
reshaped_data <- collapsed_data %>%
  pivot_longer(all_of(var_list), names_to = "key", values_to = "value") %>%
  mutate(key = c("Female", "Male",
                 "Youth", "Adult", "Senior",
                 "Migrant", "Native",
                 "No Primary", "Primary", "Secondary", "University",
                 "Legislators", "Professionals", "Technicians",
                 "Clerks", "Services"," Agriculture and Fisheries", 
                 "Crafts", "Plant", "Elementary", "Army", "Other",
                 "Urban", "Rural"),
         group = c(1,1,
                   2,2,2,
                   3,3,
                   4,4,4,4,
                   5,5,5,5,5,5,5,5,5,5,5,
                   6,6),
         label = c(rep("Gender", 2), rep("Age", 3), rep("Migration Status", 2), 
                   rep("Education", 4), rep("Occupation", 11),rep("Urban/Rural", 2))) %>%   group_by(label) %>%   mutate(subtot = sum(value)) %>%   mutate(value.resc = value/subtot) 


ggplot(reshaped_data, aes(x = reorder(factor(key), group), y = value.resc, fill = factor(group))) +
  geom_bar(
    width = 0.8, position = position_dodge(width = 0.8), 
    stat = "identity", alpha = 0.7
  ) +
  geom_text(
    aes(label = format(round(value.resc, 5), nsmall = 2)), 
    position = position_dodge(width = 0.8), 
    size = 3,
    hjust = -0.35
  ) +
  scale_fill_discrete(
    breaks = factor(reshaped_data$group), 
    labels = reshaped_data$label
  ) +
  coord_flip(ylim = c(0, max(reshaped_data$value.resc)+0.2)) +
  geom_hline(yintercept = 0, alpha = 0.5) +
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text = element_text(size = 10),
    legend.title = element_blank(),
    legend.position = "bottom"
  ) 

```

</details>
</details>